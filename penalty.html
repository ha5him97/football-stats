<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>3D Penalty Shootout</title>
<style>
  body{margin:0;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#0b2a3a;color:#fff;font-family:sans-serif}
  canvas{background:linear-gradient(#176b4e,#1b8a66);border:4px solid #fff;border-radius:10px}
  .hud{margin-top:15px;text-align:center}
  .scoreboard{margin:10px;font-size:20px}
  .power-bar{width:200px;height:20px;background:#333;border-radius:6px;overflow:hidden;margin:10px auto}
  #power{height:100%;width:0;background:red;transition:width 0.05s}
  button{margin:5px;padding:10px 16px;border:none;border-radius:6px;background:#ffcc00;color:#000;font-weight:bold;cursor:pointer}
</style>
</head>
<body>

<canvas id="game" width="900" height="600"></canvas>

<div class="hud">
  <div class="scoreboard">
    Player <span id="pScore">0</span> - <span id="cScore">0</span> Computer  
    (<span id="turnInfo">Player</span>'s turn)
  </div>
  <div class="power-bar"><div id="power"></div></div>
  <button id="shootBtn">Hold Space / Click to Shoot</button>
  <div id="message"></div>
</div>

<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
const pScoreEl=document.getElementById("pScore"),cScoreEl=document.getElementById("cScore"),turnInfo=document.getElementById("turnInfo");
const msg=document.getElementById("message"),powerEl=document.getElementById("power");

let turn="player",playerScore=0,compScore=0,pShots=0,cShots=0,shotsEach=5;
let charging=false,power=0,ball=null,keeper=null,inPlay=false;
let trail=[]; // trajectory line

function resetBall(){
  ball={x:450,y:520,z:0,vx:0,vy:0,vz:0,r:15,inAir:false};
  trail=[];
}
function resetKeeper(){
  keeper={x:450,y:100,z:200,r:40,dive:"center"};
}
resetBall();resetKeeper();

// Fake 3D projection
function project(x,y,z){
  let scale=300/(z+300);
  return {x:450+(x-450)*scale,y:y*scale+50,z,scale};
}

function drawField(){
  ctx.fillStyle="#1b8a66";ctx.fillRect(0,0,900,600);
  ctx.strokeStyle="#fff";ctx.lineWidth=2;
  // Perspective goal (trapezoid)
  ctx.beginPath();
  ctx.moveTo(300,100);ctx.lineTo(600,100);
  ctx.lineTo(500,50);ctx.lineTo(400,50);
  ctx.closePath();ctx.stroke();
}

function drawBall(){
  if(trail.length>1){
    ctx.beginPath();
    ctx.moveTo(trail[0].x,trail[0].y);
    for(let i=1;i<trail.length;i++){
      ctx.lineTo(trail[i].x,trail[i].y);
    }
    ctx.strokeStyle="yellow";ctx.lineWidth=2;ctx.stroke();
  }
  let p=project(ball.x,ball.y,ball.z);
  ctx.beginPath();
  ctx.arc(p.x,p.y,ball.r*p.scale,0,Math.PI*2);
  ctx.fillStyle="#fff";ctx.fill();
}

function drawKeeper(){
  let p=project(keeper.x,keeper.y,keeper.z);
  ctx.beginPath();
  ctx.arc(p.x,p.y,keeper.r*p.scale,0,Math.PI*2);
  ctx.fillStyle="#222";ctx.fill();
}

function update(){
  drawField();

  if(ball.inAir){
    ball.x+=ball.vx;
    ball.y+=ball.vy;
    ball.z+=ball.vz;
    ball.vy+=0.2; // gravity

    let p=project(ball.x,ball.y,ball.z);
    trail.push({x:p.x,y:p.y});
    if(trail.length>30) trail.shift();

    // Goal line = z ~ 200
    if(ball.z>=200){
      let dx=ball.x-keeper.x,dy=ball.y-keeper.y;
      let dist=Math.sqrt(dx*dx+dy*dy);
      if(dist<keeper.r){
        msg.textContent=(turn==="player"?"âŒ Saved!":"âŒ Computer shot saved!");
        endShot(false);return;
      } else {
        msg.textContent=(turn==="player"?"âš½ Goal!":"ðŸ’» Computer scores!");
        if(turn==="player"){playerScore++;pScoreEl.textContent=playerScore;}
        else{compScore++;cScoreEl.textContent=compScore;}
        endShot(true);return;
      }
    }

    if(ball.y>600||ball.x<0||ball.x>900){
      msg.textContent="Missed!";
      endShot(false);return;
    }
  }

  if(keeper.dive==="left")keeper.x-=4;
  else if(keeper.dive==="right")keeper.x+=4;

  drawBall();
  drawKeeper();
  requestAnimationFrame(update);
}

function endShot(goal){
  ball.inAir=false;inPlay=false;
  if(turn==="player"){pShots++;}else{cShots++;}
  checkGameEnd();
  setTimeout(()=>{
    resetBall();resetKeeper();
    turn=(turn==="player"?"comp":"player");
    turnInfo.textContent=turn==="player"?"Player":"Computer";
    if(turn==="comp")setTimeout(compShot,1000);
  },1000);
}

function compShot(){
  inPlay=true;
  keeper.dive=["left","center","right"][Math.floor(Math.random()*3)];
  ball.vx=(Math.random()*2-1)*2;
  ball.vy=-8;
  ball.vz=6;
  ball.inAir=true;
}

function checkGameEnd(){
  if(pShots>=shotsEach&&cShots>=shotsEach){
    if(playerScore>compScore)msg.textContent="ðŸŽ‰ Player wins!";
    else if(playerScore<compScore)msg.textContent="ðŸ’» Computer wins!";
    else msg.textContent="ðŸ¤ Draw! Sudden death coming...";
  }
}

document.getElementById("shootBtn").onmousedown=()=>{if(turn==="player"&&!inPlay){charging=true;}};
document.getElementById("shootBtn").onmouseup=()=>{if(charging)shootPlayer();};

window.addEventListener("keydown",e=>{if(e.code==="Space"&&turn==="player"&&!inPlay)charging=true;});
window.addEventListener("keyup",e=>{if(e.code==="Space"&&charging)shootPlayer();});

function shootPlayer(){
  charging=false;inPlay=true;
  let shotPower=8+power*0.1;
  let aim=(Math.random()*2-1)*3;
  ball.vx=aim;ball.vy=-shotPower;ball.vz=6;
  ball.inAir=true;
  keeper.dive=["left","center","right"][Math.floor(Math.random()*3)];
  power=0;powerEl.style.width="0%";
}

function powerLoop(){
  if(charging){power=(power+2)%100;powerEl.style.width=power+"%";}
  requestAnimationFrame(powerLoop);
}

update();powerLoop();
</script>
</body>
</html>
